<div class="container">
  <h2>注文履歴詳細</h2>
  <table>
    <tr>
      <td><b>購入者</b></td>
      <td><%= @order.customer.full_name %></td>
    </tr>
    <tr>
      <td><b>注文日</b></td>
      <td><%= @order.created_at.strftime('%Y/%m/%d') %></td>
    </tr>
    <tr>
      <td><b>配送先</b></td>
      <td>
        〒<%= @order.postal_code %>
        <%= @order.address %>
      </td>
    <tr>
      <td></td>
      <td>
        <%= @order.name %>
      </tb>
    </tr>
    </tr>
    <tr>
      <td><b>支払い方法</b></td>
      <td>
        <%= @order.payment_method_i18n %>
        <!-- t("enums.order.payment_method.#{@order.payment_method}") %>-->
      </td>
    </tr>
    <tr>
      <td><b>注文ステータス</b></b></td>
      <%= form_with model: @order, url: admin_order_path(@order), method: :patch do |f| %>
      <td>
        <%= f.select :status, Order.statuses.keys.map{|k| [I18n.t("enums.order.status.#{k}"), k]} %>
          <!-- f.select :status, [["入金待ち", 0],["入金確認", 1],["製作中", 2],["発送準備中",3],["発送済み",4]] %>-->
      <!--< f.select :status, options_for_select([[I18n.t('enums.order.status.waiting'), 'waiting'],-->
      <!--                                        [I18n.t('enums.order.status.payment'), 'payment'],-->
      <!--                                        [I18n.t('enums.order.status.production'), 'production'],-->
      <!--                                        [I18n.t('enums.order.status.preparation'), 'preparation'],-->
      <!--                                        [I18n.t('enums.order.status.delivered'), 'delivered'],-->
      <!--                                        ]) %>-->
      </td>
      <td><%= f.submit '更新' %></td>
      <% end %>
    </tr>
  </table>
  
  <table>
    <thead>
      <tr>
        <th>商品名</th>
        <th>単価（税込）</th>
        <th>数量</th>
        <th>小計</th>
        <th>制作ステータス</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @order_items.each do |item| %>
      <tr>
        <td><%= item.item.name %></td>
        <td><%= item.price %></td>
        <td><%= item.amount %></td>
        <td><%= item.subtotal %></td>
        <td>
           <%= form_with model: item, url: admin_order_detail_path(item.id), method: :patch do |f| %>
          <%= f.select :making_status, OrderDetail.making_statuses.keys.map{|k| [I18n.t("enums.order_detail.making_status.#{k}"), k]} %></td>
        <td><%= f.submit '更新' %></td>
           <% end %>
      <% end %>
      </tr>
    </tbody>
  </table>
  
  <table>
    <tr>
      <td>商品合計</td>
      <td>
        <% @sum = 0 %>
        <% @order.order_details.each do |detail| %>
        <% @sum += detail.subtotal %>
        <% end %>
        <%= @sum %>
        
      </td>
    </tr>
    <tr>
      <td>送料</td>
      <td><%= @shipping_cost %></td>
    </tr>
    <tr>
      <td>請求金額合計</td>
      <td><%= @order.total_payment %></td>
    </tr>
  </table>
</div>

